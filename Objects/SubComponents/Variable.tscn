[gd_scene load_steps=6 format=3 uid="uid://k23hjb8uimrp"]

[ext_resource type="Texture2D" uid="uid://cupclxlgjwjmg" path="res://Assets/Icons/trash_icon.png" id="1_qgrst"]
[ext_resource type="Texture2D" uid="uid://cv4o31xq3mc01" path="res://Assets/Icons/bool_icon.png" id="2_1iil2"]
[ext_resource type="Texture2D" uid="uid://br8gl4fjvfa84" path="res://Assets/Icons/int_icon.png" id="3_wmcdv"]
[ext_resource type="Texture2D" uid="uid://bjbupmf3if01e" path="res://Assets/Icons/str_icon.png" id="4_5xlia"]

[sub_resource type="GDScript" id="GDScript_ewvqn"]
script/source = "extends PanelContainer


@onready var type_selection = $MarginContainer/VBoxContainer/HBoxContainer/OptionButton
@onready var name_input = $MarginContainer/VBoxContainer/HBoxContainer2/LineEdit

@onready var boolean_edit = $MarginContainer/VBoxContainer/HBoxContainer3/BooleanEdit
@onready var number_edit = $MarginContainer/VBoxContainer/HBoxContainer3/NumberEdit
@onready var string_edit = $MarginContainer/VBoxContainer/HBoxContainer3/StringEdit

var update_callback: Callable = GlobalVariables.empty_callback
var current_name: String:
	get:
		return current_name
	set(value):
		current_name = value
		name_input.text = value

var current_text: String:
	get:
		return current_text
	set(value):
		current_text = value
		string_edit.text = value

var current_type_index: int:
	get:
		return current_type_index
	set(index):
		current_type_index = index
		type_selection.selected = index
		update_value_edit()


func _ready():
	update_value_edit()


func _to_dict():
	return {
		\"Name\": name_input.text,
		\"Value\": get_input_value(),
		\"Type\": type_selection.get_item_text(type_selection.selected),
	}


func _from_dict(dict):
	current_name = dict.get(\"Name\")
	
	var value = dict.get(\"Value\")
	var type_name = dict.get(\"Type\")
	match type_name:
		\"Boolean\":
			current_type_index = 0
			boolean_edit.button_pressed = value
		\"Integer\":
			current_type_index = 1
			number_edit.value = value
		\"String\":
			current_type_index = 2
			current_text = value


func update_value_edit():
	boolean_edit.hide()
	number_edit.hide()
	string_edit.hide()
	
	match type_selection.selected:
		0: # Boolean
			boolean_edit.show()
		1: # Integer
			number_edit.show()
		2: # String
			string_edit.show()


func get_input_value():
	match current_type_index:
		0: # Boolean
			return boolean_edit.button_pressed
		1: # Integer
			return number_edit.value
		2: # String
			return string_edit.text


func set_input_value(new_value):
	match current_type_index:
		0: # Boolean
			boolean_edit.button_pressed = new_value
		1: # Integer
			number_edit.value = new_value
		2: # String
			current_text = new_value


func _on_delete_pressed():
	queue_free()
	update_callback.call()


func _on_option_button_item_selected(new_index):
	if current_type_index != new_index:
		current_type_index = new_index
		update_value_edit()
		update_callback.call()


func value_change(_new_value):
	update_callback.call()


func _on_string_edit_focus_exited():
	_on_string_text_submitted(string_edit.text)


func _on_string_text_submitted(new_text):
	if current_text != new_text:
		current_text = new_text
		update_callback.call()


func _on_name_edit_focus_exited():
	_on_name_text_submitted(name_input.text)


func _on_name_text_submitted(new_name):
	if current_name != new_name:
		current_name = new_name
		update_callback.call()
"

[node name="Variable" type="PanelContainer"]
offset_right = 271.0
offset_bottom = 108.0
script = SubResource("GDScript_ewvqn")

[node name="MarginContainer" type="MarginContainer" parent="."]
layout_mode = 2
theme_override_constants/margin_left = 5
theme_override_constants/margin_top = 5
theme_override_constants/margin_right = 5
theme_override_constants/margin_bottom = 5

[node name="VBox" type="VBoxContainer" parent="MarginContainer"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="HBox" type="HBoxContainer" parent="MarginContainer/VBox"]
layout_mode = 2

[node name="Label" type="Label" parent="MarginContainer/VBox/HBox"]
custom_minimum_size = Vector2(75, 0)
layout_mode = 2
text = "Name"

[node name="LineEdit" type="LineEdit" parent="MarginContainer/VBox/HBox"]
layout_mode = 2
size_flags_horizontal = 3
placeholder_text = "Variable name"

[node name="MarginContainer" type="MarginContainer" parent="MarginContainer/VBox/HBox"]
layout_mode = 2
theme_override_constants/margin_left = 10

[node name="Delete" type="TextureButton" parent="MarginContainer/VBox/HBox/MarginContainer"]
layout_mode = 2
mouse_default_cursor_shape = 2
texture_normal = ExtResource("1_qgrst")
stretch_mode = 3

[node name="HBox2" type="HBoxContainer" parent="MarginContainer/VBox"]
layout_mode = 2

[node name="Label" type="Label" parent="MarginContainer/VBox/HBox2"]
custom_minimum_size = Vector2(75, 0)
layout_mode = 2
text = "Type"

[node name="OptionButton" type="OptionButton" parent="MarginContainer/VBox/HBox2"]
layout_mode = 2
size_flags_horizontal = 3
selected = 0
item_count = 3
popup/item_0/text = "Boolean"
popup/item_0/icon = ExtResource("2_1iil2")
popup/item_1/text = "Integer"
popup/item_1/icon = ExtResource("3_wmcdv")
popup/item_1/id = 1
popup/item_2/text = "String"
popup/item_2/icon = ExtResource("4_5xlia")
popup/item_2/id = 2

[node name="HBox3" type="HBoxContainer" parent="MarginContainer/VBox"]
layout_mode = 2

[node name="Label" type="Label" parent="MarginContainer/VBox/HBox3"]
custom_minimum_size = Vector2(75, 0)
layout_mode = 2
text = "Value"

[node name="StringEdit" type="LineEdit" parent="MarginContainer/VBox/HBox3"]
visible = false
layout_mode = 2
size_flags_horizontal = 3

[node name="NumberEdit" type="SpinBox" parent="MarginContainer/VBox/HBox3"]
visible = false
layout_mode = 2

[node name="BooleanEdit" type="CheckButton" parent="MarginContainer/VBox/HBox3"]
layout_mode = 2
flat = true

[connection signal="focus_exited" from="MarginContainer/VBox/HBox/LineEdit" to="." method="_on_name_edit_focus_exited"]
[connection signal="text_submitted" from="MarginContainer/VBox/HBox/LineEdit" to="." method="_on_name_text_submitted"]
[connection signal="pressed" from="MarginContainer/VBox/HBox/MarginContainer/Delete" to="." method="_on_delete_pressed"]
[connection signal="item_selected" from="MarginContainer/VBox/HBox2/OptionButton" to="." method="_on_option_button_item_selected"]
[connection signal="focus_exited" from="MarginContainer/VBox/HBox3/StringEdit" to="." method="_on_string_edit_focus_exited"]
[connection signal="text_submitted" from="MarginContainer/VBox/HBox3/StringEdit" to="." method="_on_string_text_submitted"]
[connection signal="value_changed" from="MarginContainer/VBox/HBox3/NumberEdit" to="." method="value_change"]
[connection signal="toggled" from="MarginContainer/VBox/HBox3/BooleanEdit" to="." method="value_change"]
